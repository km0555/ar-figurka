<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AR Chihuahua имитация поверхности с камерой</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded shadow="type: pcfsoft">
    <a-assets>
      <a-asset-item id="dogModel" src="chihuahua_derp_dog.glb"></a-asset-item>
    </a-assets>

    <!-- Камера с видео фоном -->
    <a-entity id="camera" camera position="0 1.6 3"></a-entity>

    <!-- Видео с камеры -->
    <a-entity id="video-plane"></a-entity>

    <!-- Имитация пола -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#777" shadow></a-plane>

    <!-- Собака -->
    <a-entity
      id="dog"
      gltf-model="#dogModel"
      scale="0.05 0.05 0.05"
      position="0 -0.5 -2"
      rotation="0 180 0"
      shadow="cast: true; receive: false"
      animation="property: rotation; to: 0 540 0; loop: true; dur: 8000; easing: linear"
    ></a-entity>

    <!-- Свет для тени -->
    <a-entity light="type: directional; intensity: 1; castShadow: true" position="2 4 2"></a-entity>
  </a-scene>

  <script>
    // Подключаем камеру как текстуру для плоскости фона
    async function initCamera() {
      const video = document.createElement('video');
      video.autoplay = true;
      video.playsInline = true;

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        video.srcObject = stream;

        const videoPlane = document.querySelector('#video-plane');
        videoPlane.setAttribute('geometry', { primitive: 'plane', width: 16, height: 9 });
        videoPlane.setAttribute('material', { shader: 'flat', src: video });
        videoPlane.setAttribute('position', '0 4 -10'); // чуть позади сцены
        videoPlane.setAttribute('rotation', '-10 0 0');
      } catch (err) {
        alert('Не удалось получить доступ к камере: ' + err);
      }
    }

    initCamera();
  </script>
</body>
</html>
